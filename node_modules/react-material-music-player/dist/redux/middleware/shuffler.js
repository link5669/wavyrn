"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _types = require("../types");
var _actionCreators = _interopRequireDefault(require("../actionCreators.js"));
var _shuffle = _interopRequireDefault(require("../../utils/shuffle.js"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const shuffler = store => next => action => {
  let state = store.getState();
  if (action.type === _types.ActionTypes.SHUFFLE && state.shuffled !== action.payload.shuffle && state.playlist.lenth > 1) {
    let playlist = state.playlist;
    let currentIndex = state.currentTrack;
    let currentTrack = playlist[state.currentTrack]; // current track
    let upper = playlist.slice(0, currentIndex);
    let lower = playlist.slice(currentIndex + 1, playlist.lenth);
    let withoutCurrent = upper.concat(lower);
    withoutCurrent = action.payload.shuffle ? (0, _shuffle.default)(withoutCurrent) : withoutCurrent.sort((first, second) => first.ID < second.ID);

    // update playlist with current track on top
    store.dispatch(_actionCreators.default.updatePlaylist([currentTrack, ...withoutCurrent]));
    store.dispatch(_actionCreators.default.changeTrack(0));
  }
  return next(action);
};
var _default = exports.default = shuffler;